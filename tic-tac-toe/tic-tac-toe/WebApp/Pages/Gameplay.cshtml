@page
@using GameBrain
@model WebApp.Pages.Gameplay

@{
    var baseFontSize = (600 / Model.GameEngine.DimY / 2) + "px"; // Base font size
    var smallFontSize = (600 / Model.GameEngine.DimY / 3) + "px"; // Small font size
    var smallestFontSize = (600 / Model.GameEngine.DimY / 5) + "px"; // Smallest font size

    var baseBorderSize = Model.GameEngine.DimY > 15 ? "3px" : "6px"; // Border size
    var smallBorderSize = (Model.GameEngine.DimY > 15 ? 3 : 6) / 1.5 + "px"; // Border size
    var smallestBorderSize = (Model.GameEngine.DimY > 15 ? 3 : 6) / 2 + "px"; // Border size

    var gridSize = Model.GameEngine.DimY; // Grid size
}

<style>
    :root {
        --base-font-size: @baseFontSize;
        --small-font-size: @smallFontSize;
        --smallest-font-size: @smallestFontSize;
        --border-size: @baseBorderSize;
        --small-border-size: @smallBorderSize;
        --smallest-border-size: @smallestBorderSize;
        --grid-size: @gridSize;
    }
</style>

<div class="container">
    <div class="row">
        <!-- Left Column (MoveMaker) -->
        <div class="col-md-2 d-flex align-items-center" id="moveMaker">
            <span class="badge bg-secondary">It's @Model.NextMoveBy's turn</span>
        </div>

        <!-- Center Column (Game Board) -->
        <div class="col-md-8 d-flex justify-content-center">
            <form id="dragForm" method="post">
                <!-- Using asp-for for From and To hidden inputs -->
                <input type="hidden" asp-for="From" id="from">
                <input type="hidden" asp-for="To" id="to">
                <div class="game-board">
                    @for (int x = 0; x < Model.GameEngine.DimY; x++)
                    {
                        for (int y = 0; y < Model.GameEngine.DimY; y++)
                        {
                            var boxId = $"{x},{y}";
                            var isPiecePresent = Model.GameEngine.CurrentGridCoordinates.Any(coord => coord[0] == x && coord[1] == y);

                            <!-- No change to drag-and-drop logic, keeping it as is -->
                            @if (isPiecePresent)
                            {
                                <a href="#" class="grid" id="@boxId" draggable="true"
                                   ondragstart="document.getElementById('from').value='@boxId'"
                                   ondragover="event.preventDefault()"
                                   ondrop="document.getElementById('to').value='@boxId'; document.getElementById('dragForm').submit();"
                                   onclick="document.getElementById('to').value='@boxId'; document.getElementById('dragForm').submit();">
                                    @Html.Raw(ConsoleUI.Visualizer.DrawGamePiece(Model.GameEngine.GameBoard[x][y]))
                                </a>
                            }
                            else
                            {
                                <a href="#" class="board" id="@boxId" draggable="true"
                                   ondragstart="document.getElementById('from').value='@boxId'"
                                   ondragover="event.preventDefault()"
                                   ondrop="document.getElementById('to').value='@boxId'; document.getElementById('dragForm').submit();"
                                   onclick="document.getElementById('to').value='@boxId'; document.getElementById('dragForm').submit();">
                                    @Html.Raw(ConsoleUI.Visualizer.DrawGamePiece(Model.GameEngine.GameBoard[x][y]))
                                </a>
                            }
                        }
                    }
                </div>
            </form>
        </div>

        <!-- Right Column (Arrow Buttons) -->
        <div class="col-md-2 d-flex justify-content-center align-items-center">
            <form method="post" id="arrowForm">
                <div class="arrow-grid">
                    <!-- Top row -->
                    <button type="submit" class="btn btn-primary arrow-btn" name="ArrowDirection" value="nw" aria-label="Arrow Top Left">&#8598;</button>
                    <button type="submit" class="btn btn-primary arrow-btn" name="ArrowDirection" value="w" aria-label="Arrow Up">&#8593;</button>
                    <button type="submit" class="btn btn-primary arrow-btn" name="ArrowDirection" value="sw" aria-label="Arrow Top Right">&#8599;</button>

                    <!-- Middle row -->
                    <button type="submit" class="btn btn-primary arrow-btn" name="ArrowDirection" value="n" aria-label="Arrow Left">&#8592;</button>
                    <div class="empty-cell"></div> <!-- Middle Empty Cell -->
                    <button type="submit" class="btn btn-primary arrow-btn" name="ArrowDirection" value="s" aria-label="Arrow Right">&#8594;</button>

                    <!-- Bottom row -->
                    <button type="submit" class="btn btn-primary arrow-btn" name="ArrowDirection" value="ne" aria-label="Arrow Bottom Left">&#8601;</button>
                    <button type="submit" class="btn btn-primary arrow-btn" name="ArrowDirection" value="e" aria-label="Arrow Down">&#8595;</button>
                    <button type="submit" class="btn btn-primary arrow-btn" name="ArrowDirection" value="se" aria-label="Arrow Bottom Right">&#8600;</button>
                </div>
            </form>
        </div>
    </div>
</div>
